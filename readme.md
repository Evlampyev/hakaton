# Веб-сайт "Единая Дежурно-Диспетчерская Служба 112" 
#http://emergency-112.herokuapp.com/

## Описание 

Для унификации вызова экстренных служб в России создается единая дежурно-диспетчерская служба, действующая по телефонному номеру 112. После поступления звонка оператор в течение 30 секунд должен принять решение, какие экстренные службы должны быть вызваны.
Если все операторы заняты, то пострадавшие или свидетели происшествия могут длительное время ожидать соединения, что может привести к гибели людей.

Поэтому актуальна задача частичной автоматизации деятельности колл-центра, например автоматического определения вызываемой службы по сообщению о происшествии.
Разработанный прототип веб-сайта "Единая Дежурно-Диспетчерская Служба 112"
реализует базовый функционал подобной информационной системы.

Сайт использует классификатор на основе логистической регрессии, предобученный на большом наборе сообщений о происшествиях.
Классификатор по сообщению определяет какую службу вызывать: скорую помощь, пожарную охрану или полицию, причем доля правильных ответов превышает 90%.

Сайт сохраняет информацию о вызовах экстренных служб, отображает их на интерактивной карте.
Авторизованные операторы имеют возможность добавлять вызовы, просматривать, редактировать и удалять их.
Поддерживается регистрация операторов, редактирование профиля оператора. Сайт поддерживает добавление и просмотр вызовов через API.
Для вызова службы может использоваться навык Алисы.


## Основные возможности программы

- Для неавторизованного пользователя доступен только просмотр карты вызовов, регистрация и вход.
- Карта вызовов сделана с помощью API Яндекс-карты, отображает все вызовы, для которых статус не равен finished (завершен).
- Карта автоматически масштабируется при обновлении страницы, чтобы отобразить все вызовы.
- Для вызовов полиции, скорой помощи и пожарной охраны используются различные специально подобранные значки.
- Для авторизованного оператора щелчок по значку показывает ссылку для открытия страницы редактирования вызова в новой вкладке.
- Авторизованный оператор имеет возможность просматривать список вызовов, редактировать данные о вызове, добавлять и удалять вызовы.
- Авторизованный оператор имеет возможность работать со всеми вызовами, как добавленными им, так и другими операторами, а также добавленными через API и навык Алисы.
- Страница добавления вызова появляется при выборе пункта "Новый вызов" в выпадающем меню "Вызовы" или нажатии кнопки на странице просмотра вызовов.
- При добавлении вызова заполняется только сообщение и адрес. Вызываемая служба определяется автоматически.
- При вводе адреса во всех формах происходит проверка на его существование с помощью API Яндекс Геокодер.
- Также при добавлении устанавливается статус received (принят) и запоминается время вызова.
- Вызов имеет статусы received(принят), serviced(выполняется) и finished(завершен). 
- Изменение статусов автоматически изменяет время вызова и время завершения.
- Время в базе данных хранится в формате UTC, часовой пояс оператора определяется автоматически на основе времени в его браузере 
  с помощью библиотеки flask-moment. На страницах время отображается в часовом поясе оператора.
- Страница просмотра списка вызовов появляется при выборе пункта "Список вызовов" в выпадающем меню "Вызовы".
- Для каждого вызова отражается основная информация о нем. 
- Адрес в списке вызовов отображается в виде геоссылки, при щелчке на адресе всплывает окно с картой.
- Кнопка в строке вызова справа открывает страницу редактирования вызова.
- На странице редактирования вызова отображается полная информация о нем, можно поменять все поля, в том числе службу вызова, статус, адрес и сообщение.
- Также на странице редактирования вызова отображается карта с отметкой адреса, созданная с помощью API Яндекс.
- Регистрация, авторизация и редактирование профиля оператора осуществляется на основе стандартной схемы из учебника.
- Приложение поддерживает доступ через API для некоторых операций с вызовами.
- Метод Get по адресу /api/calls возвращает список вызовов в формате JSON.
- Метод Post по адресу /api/calls добавляет вызов. Должен передаваться словарь с ключами "message" и "address".
- Метод Get по адресу /api/calls/id возвращает информацию об одном вызове в формате JSON.
- По адресу /calls/post реализован навык "ЕДДС" для Алисы. Навык зарегистрирован как приватный. 10 одноразовых ссылок для доступа к нему приведены в конце этого файла.
- Навык представляется и предлагает сообщить, что произошло. Если количество токенов в сообщении меньше 8, то предлагается рассказать о происшествии более подробно.
- Затем предлагается сообщить адрес. Если Алиса не нашла геообъект, в нем не полная информация, или адрес не прошел проверку через API геокодера, то предлагается его повторить.
- Если сообщение и адрес получены, то вызов добавляется в базу данных и отправляется информация о вызове - какая служба и по какому адресу вызвана.
- Портал развернут по адресу http://emergency-112.herokuapp.com/
- Программа пытается обрабатывать ошибки, если страница не найдена - на основе запроса решает выдавать страницу с ошибкой или возвращать JSON.
- Также некоторый интерес для других проектов может представлять класс AddressRequired - валидатор для проверки существования российского адреса.

## Технические требования 
- Должны быть установлены все библиотеки из requirements.txt. 
- Кроме библиотек, рассмотренных в учебном курсе, использованы библиотеки:
  - flask_moment - для определения часового пояса пользователя веб-приложения. 
  - joblib - для загрузки модели классификации сообщений.
  - numpy, scikit-learn - объекты для предобработки текстов и классификации сообщений.  
- После установки всех библиотек в локальном окружении приложение занимает 260 Мбайт.  
- Структура папок:
  - data - классы для хранения данных и API.
  - db - база данных.
  - forms - классы форм и валидаторов.
  - model - файл с классификатором.
  - static - стили, картинки, а также map.js - код на JavaScript для создания карты вызовов.
  - templates - шаблоны всех страниц.
  - templates - шаблоны всех страниц.
- main.py - вывод страниц и общие настройки приложения, alice.py - реализация навыка.
- test_api.py - программа для тестирования API.
  
## Ссылки для доступа к навыку  
https://dialogs.yandex.ru/share?key=Si3Gts2G3bFdV0oZPhmi
https://dialogs.yandex.ru/share?key=cFa3VYrerlf0dPtDVAw1
https://dialogs.yandex.ru/share?key=G5OP2uk9QBIj8CKEX1nD
https://dialogs.yandex.ru/share?key=cPrRsHYwtjyfWFXUgGWy
https://dialogs.yandex.ru/share?key=FMw15zVIJZkehiMaKoBx
https://dialogs.yandex.ru/share?key=3c6RgpZZ898SMTyR1jnI
https://dialogs.yandex.ru/share?key=9llYTC82AyiOVYdduIBr
https://dialogs.yandex.ru/share?key=5IMsIEkYjVfHQP9yxrsz
https://dialogs.yandex.ru/share?key=5EG0INS5PbezodEw4EHV
https://dialogs.yandex.ru/share?key=U7DuiuKUAYhqsISDusPn

